#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Check for Yarn or Node installation
if command -v yarn >/dev/null 2>&1; then
    packageManager="yarn"
elif command -v npm >/dev/null 2>&1; then
    packageManager="npm"
else
    echo 'Neither Yarn nor Node.js is installed. Please install one of them to proceed.'
    exit 1
fi

echo 'ğŸ—ï¸ğŸ‘· Estilizando, testando e buildando seu cÃ³digo antes de commitar . . .\n'

# Define a function to run the package manager command
runCmd() {
    if [ "$packageManager" = "yarn" ]; then
        yarn run "$@"
    else
        npm run "$@"
    fi
}

# Check Prettier standards
if ! runCmd check-format; then
    echo '\nğŸ¤¢ğŸ¤® Parece haver um problema de estilo ğŸ¤¢ğŸ¤®
    Checagem do Prettier falhou... Rode um yarn/npm format, adicione as alteraÃ§Ãµes e tente novamente.\n';
    exit 1;
fi

# Check ESLint Standards
if ! runCmd check-lint; then
    echo '\nğŸ˜¤ğŸ€ğŸ‘‹ğŸ˜¤ Daqui nÃ£o passa! ğŸ˜¤ğŸ€ğŸ‘‹ğŸ˜¤
    Checagem do ESLint falhou... FaÃ§a as alteraÃ§Ãµes listadas acima e tente novamente.\n'
    exit 1;
fi

# Check tsconfig standards
if ! runCmd check-types; then
    echo 'ğŸ¤¡ğŸ˜‚âŒğŸ¤¡ Checagem de Tipos Falhou. ğŸ¤¡ğŸ˜‚âŒğŸ¤¡
    Parece que tivemos um problema com TypeScript, faÃ§a as alteraÃ§Ãµes citadas acima.'
    exit 1;
fi

# If everything passes... Now we can commit
echo '\nğŸ¤”ğŸ¤”ğŸ¤”ğŸ¤”... Tudo bem... Parece que o cÃ³digo tÃ¡ legal... Vamos tentar buildar. ğŸ¤”ğŸ¤”ğŸ¤”ğŸ¤”\n'

if ! runCmd build; then
    echo '\nâŒğŸ‘·ğŸ”¨âŒ Seu build falhou!!!! âŒğŸ‘·ğŸ”¨âŒ
    Falha ao buildar: entenda o que aconteceu vendo os erros acima.\n'
    exit 1;
fi

# If everything passes... Now we can commit
echo '\n\nâœ…âœ…âœ…âœ… VocÃª ganhou dessa vez, commitando agora. âœ…âœ…âœ…âœ…\n'
